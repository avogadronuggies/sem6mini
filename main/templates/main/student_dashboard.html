<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #3674b5;
        --secondary: #578fca;
        --light: #d1f8ef;
        --accent: #a1e3f9;
        --success: #28a745;
        --danger: #dc3545;
        --transition: all 0.3s ease;
        --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        --shadow-hover: 0 10px 15px rgba(0, 0, 0, 0.15);
        --border-radius: 15px;
      }

      body {
        background-color: var(--light);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        padding-top: 56px;
      }

      .navbar {
        position: fixed;
        top: 0;
        width: 100%;
        background-color: var(--primary);
        box-shadow: var(--shadow);
        z-index: 1000;
      }

      .sidebar {
        background: linear-gradient(135deg, var(--accent), var(--secondary));
        height: 100vh;
        box-shadow: var(--shadow);
        position: fixed;
        top: 56px;
        left: 0;
        z-index: 100;
        padding-top: 20px;
        transition: var(--transition);
      }

      .sidebar .nav-link {
        color: #fff;
        padding: 10px 15px;
        margin: 5px 0;
        border-radius: 5px;
        transition: var(--transition);
      }

      .sidebar .nav-link:hover,
      .sidebar .nav-link.active {
        background-color: rgba(255, 255, 255, 0.2);
        transform: translateX(5px);
      }

      .main-content {
        margin-left: 250px;
        padding: 20px;
        transition: var(--transition);
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <i class="fas fa-user-graduate me-2"></i>
          Dashboard
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdown"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="fas fa-user-circle me-1"></i>
                <span id="studentName">{{ student_data.details.0 }}</span>
              </a>
              <ul
                class="dropdown-menu dropdown-menu-end"
                aria-labelledby="navbarDropdown"
              >
                <li>
                  <a class="dropdown-item" href="{% url 'logout' %}">
                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                  </a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Sidebar -->
    <nav class="sidebar">
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link active" href="{% url 'student_dashboard' %}">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
          </a>
        </li>
      </ul>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
      <h1>Welcome, {{ student_data.details.0 }}</h1>
      <p><strong>Branch:</strong> {{ student_data.details.1 }}</p>
      <p><strong>Current Semester:</strong> {{ student_data.details.2 }}</p>
      <p><strong>Batch Year:</strong> {{ student_data.details.3 }}</p>
      <p><strong>Phone:</strong> {{ student_data.details.4 }}</p>
      <p><strong>Email:</strong> {{ student_data.details.5 }}</p>
      <p><strong>Address:</strong> {{ student_data.details.6 }}</p>

      <h2>Academic Records</h2>
      {% if student_data.academic_records %}
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Semester</th>
            <th>Department</th>
            <th>Course Name</th>
            <th>Marks</th>
          </tr>
        </thead>
        <tbody>
          {% for record in student_data.academic_records %}
          <tr>
            <td>{{ record.0 }}</td>
            <td>{{ record.1 }}</td>
            <td>{{ record.2 }}</td>
            <td>{{ record.3 }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p>No academic records available.</p>
      {% endif %}

      <h2>Attendance Records</h2>
      {% if student_data.attendance_records %}
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Semester</th>
            <th>Department</th>
            <th>Course Name</th>
            <th>Attendance (%)</th>
          </tr>
        </thead>
        <tbody>
          {% for record in student_data.attendance_records %}
          <tr>
            <td>{{ record.0 }}</td>
            <td>{{ record.1 }}</td>
            <td>{{ record.2 }}</td>
            <td>{{ record.3 }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p>No attendance records available.</p>
      {% endif %}

      <h2>Feedback</h2>
      {% if student_data.feedback %}
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Course Name</th>
            <th>Feedback</th>
            <th>Sentiment Score</th>
          </tr>
        </thead>
        <tbody>
          {% for feedback in student_data.feedback %}
          <tr>
            <td>{{ feedback.0 }}</td>
            <td>{{ feedback.1 }}</td>
            <td>{{ feedback.2 }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p>No feedback available.</p>
      {% endif %}

      <h2>Dropout Risk</h2>
      {% if dropout_risk %}
      <p><strong>Risk Score:</strong> {{ dropout_risk.0 }}</p>
      <p><strong>Risk Level:</strong> {{ dropout_risk.1 }}</p>
      <p><strong>Confidence Score:</strong> {{ dropout_risk.2 }}</p>
      <p><strong>Contributing Factors:</strong> {{ dropout_risk.3 }}</p>
      <div class="progress" style="height: 20px">
        <div
          class="progress-bar {% if dropout_risk.1 == 'High' %}bg-danger{% elif dropout_risk.1 == 'Medium' %}bg-warning{% else %}bg-success{% endif %}"
          role="progressbar"
          style="width: {{ dropout_risk.0 }}%;"
          aria-valuenow="{{ dropout_risk.0 }}"
          aria-valuemin="0"
          aria-valuemax="100"
        >
          {{ dropout_risk.1 }}
        </div>
      </div>
      {% else %}
      <p>No dropout risk data available.</p>
      {% endif %}

      <h2>Recommended Courses and Videos</h2>
      {% if course_recommendations %}
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th>Course Name</th>
              <th>Title</th>
              <th>Platform</th>
              <th>Description</th>
              <th>Link</th>
            </tr>
          </thead>
          <tbody id="course-recommendations-body">
            {% for course in course_recommendations %}
            <tr>
              <td>{{ course.course_name }}</td>
              <td>{{ course.course_title }}</td>
              <td>{{ course.platform }}</td>
              <td>{{ course.description }}</td>
              <td>
                <a
                  href="{{ course.course_url }}"
                  target="_blank"
                  class="btn btn-primary"
                  >View</a
                >
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <button id="load-more-btn" class="btn btn-secondary">Load More</button>
      <script>
        document
          .getElementById("load-more-btn")
          .addEventListener("click", function () {
            const courseName = "{{ weak_courses|first }}"; // Replace with the actual course name dynamically if needed
            const pageToken = this.getAttribute("data-page-token") || null;

            fetch(
              `/load_more_courses?course_name=${courseName}&page_token=${pageToken}`
            )
              .then((response) => response.json())
              .then((data) => {
                if (data.courses) {
                  const tbody = document.getElementById(
                    "course-recommendations-body"
                  );
                  data.courses.forEach((course) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td>${course.course_name || ""}</td>
                    <td>${course.course_title || ""}</td>
                    <td>${course.platform || ""}</td>
                    <td>${course.description || ""}</td>
                    <td><a href="${
                      course.course_url
                    }" target="_blank" class="btn btn-primary">View</a></td>
                  `;
                    tbody.appendChild(row);
                  });
                }

                if (data.next_page_token) {
                  document
                    .getElementById("load-more-btn")
                    .setAttribute("data-page-token", data.next_page_token);
                } else {
                  document.getElementById("load-more-btn").style.display =
                    "none";
                }
              })
              .catch((error) =>
                console.error("Error loading more courses:", error)
              );
          });
      </script>
      {% else %}
      <p>No recommendations available at the moment.</p>
      {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
